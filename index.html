<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Book - Your Culinary Collection</title>
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #667eea;
        }

        .logo .icon {
            font-size: 2rem;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover,
        .nav-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* Main Content */
        .main {
            margin-top: 80px;
            min-height: calc(100vh - 80px);
        }

        .section {
            display: none;
            padding: 40px 0;
        }

        .section.active {
            display: block;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 40px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
            padding: 80px 0;
            text-align: center;
            color: white;
        }

        .hero-content h2 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .hero-content p {
            font-size: 1.3rem;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        /* Search Container */
        .search-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .search-box {
            display: flex;
            background: white;
            border-radius: 50px;
            padding: 5px 5px 5px 20px;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .search-box .icon {
            color: #667eea;
            margin-right: 15px;
            font-size: 1.2rem;
        }

        .search-box input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 1.1rem;
            color: #333;
            padding: 10px;
        }

        .search-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* Recipe Grid */
        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .recipe-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            max-width: 400px;
            margin: 0 auto;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .recipe-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .recipe-image-placeholder {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
        }

        .recipe-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .recipe-card:hover .recipe-actions {
            opacity: 1;
        }

        .delete-recipe-btn {
            background: #ff4757;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .delete-recipe-btn:hover {
            background: #ff3742;
            transform: scale(1.1);
        }

        .recipe-content {
            padding: 20px;
        }

        .recipe-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .recipe-meta {
            display: flex;
            justify-content: space-between;
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 12px;
        }

        .recipe-category {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Form Styles */
        .recipe-form {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Dynamic Inputs */
        .ingredient-input,
        .instruction-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: flex-start;
        }

        .ingredient-input input,
        .instruction-input textarea {
            flex: 1;
        }

        .delete-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 40px;
            font-size: 14px;
        }

        .delete-btn:hover {
            background: #ff3742;
            transform: scale(1.05);
        }

        .add-btn {
            background: #2ed573;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-btn:hover {
            background: #26d063;
            transform: translateY(-2px);
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 30px auto 0;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        /* Recipes Header */
        .recipes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .filter-container select {
            padding: 12px 20px;
            border: 2px solid white;
            border-radius: 25px;
            background: white;
            color: #333;
            font-weight: 500;
            cursor: pointer;
            outline: none;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 95vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .close {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
            z-index: 10;
            background: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .close:hover {
            color: #333;
            transform: scale(1.1);
        }

        /* Recipe Detail */
        .recipe-detail {
            padding: 20px 40px 40px 40px;
        }

        .recipe-detail-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .recipe-detail-image {
            width: 100%;
            max-width: 400px;
            height: 300px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .recipe-detail-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
        }

        .recipe-detail-meta {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            font-weight: 500;
        }

        .meta-item .icon {
            color: #667eea;
        }

        .ingredients-section,
        .instructions-section {
            margin-bottom: 30px;
        }

        .ingredients-section h3,
        .instructions-section h3 {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ingredients-section h3 .icon,
        .instructions-section h3 .icon {
            color: #667eea;
        }

        .ingredients-list {
            list-style: none;
        }

        .ingredients-list li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ingredients-list li:before {
            content: "🔸";
            color: #667eea;
        }

        .instructions-list {
            list-style: none;
            counter-reset: step-counter;
        }

        .instructions-list li {
            counter-increment: step-counter;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            position: relative;
        }

        .instructions-list li:before {
            content: counter(step-counter);
            position: absolute;
            left: -15px;
            top: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* Success Message */
        .success-message {
            position: fixed;
            top: 100px;
            right: 20px;
            background: #2ed573;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(46, 213, 115, 0.3);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1500;
            animation: slideIn 0.3s ease;
        }

        .success-message.show {
            display: flex;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* No recipes message */
        .no-recipes {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            padding: 60px 20px;
        }

        .no-recipes .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.7;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header .container {
                flex-direction: column;
                gap: 15px;
            }

            .nav {
                flex-wrap: wrap;
                justify-content: center;
            }

            .nav-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }

            .hero-content h2 {
                font-size: 2.5rem;
            }

            .hero-content p {
                font-size: 1.1rem;
            }

            .section-title {
                font-size: 2rem;
            }

            .search-box {
                flex-direction: column;
                padding: 15px;
                gap: 15px;
            }

            .search-btn {
                width: 100%;
            }

            .recipe-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .recipe-form {
                padding: 25px;
                margin: 0 10px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .recipes-header {
                flex-direction: column;
                text-align: center;
            }

            .modal-content {
                width: 95%;
                margin: 2% auto;
            }

            .recipe-detail {
                padding: 20px;
            }

            .recipe-detail-title {
                font-size: 2rem;
            }

            .recipe-detail-meta {
                flex-direction: column;
                gap: 15px;
            }

            .main {
                margin-top: 140px;
            }
        }

        @media (max-width: 480px) {
            .hero-content h2 {
                font-size: 2rem;
            }

            .logo h1 {
                font-size: 1.5rem;
            }

            .nav-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }

            .main {
                margin-top: 160px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <span class="icon">🍴</span>
                <h1>Recipe Book</h1>
            </div>
            <nav class="nav">
                <button class="nav-btn active" onclick="showSection('home')">
                    <span class="icon">🏠</span> Home
                </button>
                <button class="nav-btn" onclick="showSection('add-recipe')">
                    <span class="icon">➕</span> Add Recipe
                </button>
                <button class="nav-btn" onclick="showSection('view-recipes')">
                    <span class="icon">📚</span> My Recipes
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Home Section -->
        <section id="home" class="section active">
            <div class="hero">
                <div class="hero-content">
                    <h2>Welcome to Your Recipe Book</h2>
                    <p>Discover, create, and organize your favorite recipes all in one place</p>
                    <div class="search-container">
                        <div class="search-box">
                            <span class="icon">🔍</span>
                            <input type="text" id="search-input" placeholder="Search recipes by name or ingredients...">
                            <button onclick="searchRecipes()" class="search-btn">Search</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Featured Recipes -->
            <div class="container">
                <h3 class="section-title">Featured Recipes</h3>
                <div id="featured-recipes" class="recipe-grid">
                    <!-- Featured recipes will be displayed here -->
                </div>
            </div>
        </section>

        <!-- Add Recipe Section -->
        <section id="add-recipe" class="section">
            <div class="container">
                <h2 class="section-title">Add New Recipe</h2>
                <form id="recipe-form" class="recipe-form">
                    <div class="form-group">
                        <label for="recipe-name">Recipe Name</label>
                        <input type="text" id="recipe-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="recipe-category">Category</label>
                        <select id="recipe-category" required>
                            <option value="">Select Category</option>
                            <option value="appetizer">Appetizer</option>
                            <option value="main-course">Main Course</option>
                            <option value="dessert">Dessert</option>
                            <option value="beverage">Beverage</option>
                            <option value="snack">Snack</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="prep-time">Prep Time (minutes)</label>
                            <input type="number" id="prep-time" required>
                        </div>
                        <div class="form-group">
                            <label for="cook-time">Cook Time (minutes)</label>
                            <input type="number" id="cook-time" required>
                        </div>
                        <div class="form-group">
                            <label for="servings">Servings</label>
                            <input type="number" id="servings" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="recipe-image">Recipe Image</label>
                        <input type="file" id="recipe-image" accept="image/*">
                    </div>
                    
                    <div class="form-group">
                        <label for="ingredients">Ingredients</label>
                        <div id="ingredients-container">
                            <div class="ingredient-input">
                                <input type="text" placeholder="Enter ingredient" required>
                                <button type="button" onclick="removeIngredient(this)" class="delete-btn">×</button>
                            </div>
                        </div>
                        <button type="button" onclick="addIngredient()" class="add-btn">
                            ➕ Add Ingredient
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label for="instructions">Instructions</label>
                        <div id="instructions-container">
                            <div class="instruction-input">
                                <textarea placeholder="Enter instruction step" required></textarea>
                                <button type="button" onclick="removeInstruction(this)" class="delete-btn">×</button>
                            </div>
                        </div>
                        <button type="button" onclick="addInstruction()" class="add-btn">
                            ➕ Add Step
                        </button>
                    </div>
                    
                    <button type="submit" class="submit-btn">
                        💾 Save Recipe
                    </button>
                </form>
            </div>
        </section>

        <!-- View Recipes Section -->
        <section id="view-recipes" class="section">
            <div class="container">
                <div class="recipes-header">
                    <h2 class="section-title">My Recipes</h2>
                    <div class="filter-container">
                        <select id="category-filter" onchange="filterRecipes()">
                            <option value="">All Categories</option>
                            <option value="appetizer">Appetizer</option>
                            <option value="main-course">Main Course</option>
                            <option value="dessert">Dessert</option>
                            <option value="beverage">Beverage</option>
                            <option value="snack">Snack</option>
                        </select>
                    </div>
                </div>
                <div id="recipes-container" class="recipe-grid">
                    <!-- Recipes will be displayed here -->
                </div>
            </div>
        </section>
    </main>

    <!-- Recipe Detail Modal -->
    <div id="recipe-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="recipe-detail">
                <!-- Recipe details will be displayed here -->
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="success-message" class="success-message">
        <span class="icon">✅</span>
        <span>Recipe saved successfully!</span>
    </div>

    <script>
        // Recipe Book Application JavaScript

        // Global variables
        let recipes = [];
        let filteredRecipes = [];
        let currentSearchTerm = '';
        let isSearchActive = false;

        // DOM Elements - will be set after DOM loads
        let sections = {};

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded'); // Debug log
            
            // Set up DOM elements after page loads
            sections = {
                home: document.getElementById('home'),
                'add-recipe': document.getElementById('add-recipe'),
                'view-recipes': document.getElementById('view-recipes')
            };
            
            console.log('Sections found:', sections); // Debug log
            
            // Verify all sections exist
            Object.keys(sections).forEach(key => {
                if (!sections[key]) {
                    console.error(`Section not found: ${key}`);
                } else {
                    console.log(`Section found: ${key}`, sections[key]);
                }
            });
            
            loadRecipes();
            console.log('Recipes after loadRecipes:', recipes.length, recipes.map(r => ({name: r.name, category: r.category})));
            
            displayFeaturedRecipes();
            displayAllRecipes();
            
            // Add form event listener
            const recipeForm = document.getElementById('recipe-form');
            if (recipeForm) {
                recipeForm.addEventListener('submit', handleFormSubmit);
            }
            
            // Load sample recipes only if no recipes exist (first time)
            if (recipes.length === 0) {
                console.log('Loading sample recipes for first time...');
                loadSampleRecipes();
                console.log('Recipes after loadSampleRecipes:', recipes.length, recipes.map(r => ({name: r.name, category: r.category})));
            }
            
            // Add modal event listeners
            const modal = document.getElementById('recipe-modal');
            if (modal) {
                modal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        closeModal();
                    }
                });
            }
            
            // Add search input listener
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        searchRecipes();
                    }
                });
            }
        });

        // Sample recipes for demonstration
        function loadSampleRecipes() {
            const sampleRecipes = [
                {
                    id: generateId(),
                    name: "Classic Chocolate Chip Cookies",
                    category: "dessert",
                    prepTime: 15,
                    cookTime: 12,
                    servings: 24,
                    image: "https://images.unsplash.com/photo-1499636136210-6f4ee915583e?w=400&h=300&fit=crop",
                    ingredients: [
                        "2 1/4 cups all-purpose flour",
                        "1 tsp baking soda",
                        "1 tsp salt",
                        "1 cup butter, softened",
                        "3/4 cup granulated sugar",
                        "3/4 cup brown sugar",
                        "2 large eggs",
                        "2 tsp vanilla extract",
                        "2 cups chocolate chips"
                    ],
                    instructions: [
                        "Preheat oven to 375°F (190°C). Line baking sheets with parchment paper.",
                        "In a medium bowl, whisk together flour, baking soda, and salt.",
                        "In a large bowl, cream together softened butter and both sugars until light and fluffy.",
                        "Beat in eggs one at a time, then add vanilla extract.",
                        "Gradually mix in the flour mixture until just combined.",
                        "Fold in chocolate chips with a wooden spoon.",
                        "Drop rounded tablespoons of dough onto prepared baking sheets.",
                        "Bake for 9-11 minutes until golden brown around edges.",
                        "Cool on baking sheet for 5 minutes before transferring to wire rack."
                    ],
                    dateAdded: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: "Creamy Chicken Alfredo",
                    category: "main-course",
                    prepTime: 20,
                    cookTime: 25,
                    servings: 4,
                    image: "https://images.unsplash.com/photo-1621996346565-e3dbc353d2e5?w=400&h=300&fit=crop",
                    ingredients: [
                        "1 lb fettuccine pasta",
                        "2 chicken breasts, sliced",
                        "3 cloves garlic, minced",
                        "1 cup heavy cream",
                        "1 cup parmesan cheese, grated",
                        "4 tbsp butter",
                        "2 tbsp olive oil",
                        "Salt and pepper to taste",
                        "Fresh parsley for garnish"
                    ],
                    instructions: [
                        "Cook fettuccine according to package directions. Drain and set aside.",
                        "Season chicken with salt and pepper. Heat olive oil in a large skillet.",
                        "Cook chicken until golden brown and cooked through, about 6-8 minutes per side.",
                        "Remove chicken and set aside. In the same skillet, melt butter.",
                        "Add minced garlic and sauté for 1 minute until fragrant.",
                        "Pour in heavy cream and bring to a gentle simmer.",
                        "Gradually whisk in parmesan cheese until melted and smooth.",
                        "Return chicken to the skillet and add cooked pasta.",
                        "Toss everything together and garnish with fresh parsley."
                    ],
                    dateAdded: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: "Spicy Beef Tacos",
                    category: "main-course",
                    prepTime: 15,
                    cookTime: 20,
                    servings: 4,
                    image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=400&h=300&fit=crop",
                    ingredients: [
                        "1 lb ground beef",
                        "8 taco shells",
                        "1 packet taco seasoning",
                        "1 onion, diced",
                        "2 cloves garlic, minced",
                        "1 cup shredded cheese",
                        "2 tomatoes, diced",
                        "1 head lettuce, shredded",
                        "1/2 cup sour cream",
                        "1/4 cup cilantro, chopped"
                    ],
                    instructions: [
                        "Heat a large skillet over medium-high heat.",
                        "Add ground beef and cook until browned, breaking it up as it cooks.",
                        "Add diced onion and garlic, cook for 3-4 minutes until softened.",
                        "Stir in taco seasoning and cook according to package directions.",
                        "Warm taco shells according to package instructions.",
                        "Fill each taco shell with the beef mixture.",
                        "Top with shredded cheese, diced tomatoes, and lettuce.",
                        "Serve with sour cream and cilantro on the side."
                    ],
                    dateAdded: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: "Fresh Caprese Salad",
                    category: "appetizer",
                    prepTime: 15,
                    cookTime: 0,
                    servings: 4,
                    image: "https://images.unsplash.com/photo-1608897013039-887f21d8c804?w=400&h=300&fit=crop",
                    ingredients: [
                        "4 large tomatoes, sliced",
                        "8 oz fresh mozzarella, sliced",
                        "1/4 cup fresh basil leaves",
                        "3 tbsp extra virgin olive oil",
                        "2 tbsp balsamic glaze",
                        "Sea salt to taste",
                        "Fresh black pepper"
                    ],
                    instructions: [
                        "Arrange tomato and mozzarella slices alternating on a serving platter.",
                        "Tuck fresh basil leaves between the tomato and mozzarella slices.",
                        "Drizzle with extra virgin olive oil and balsamic glaze.",
                        "Season with sea salt and freshly ground black pepper.",
                        "Let sit for 10 minutes to allow flavors to meld before serving.",
                        "Serve immediately at room temperature for best flavor."
                    ],
                    dateAdded: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: "Refreshing Strawberry Smoothie",
                    category: "beverage",
                    prepTime: 5,
                    cookTime: 0,
                    servings: 2,
                    image: "https://images.unsplash.com/photo-1553530666-ba11a7da3888?w=400&h=300&fit=crop",
                    ingredients: [
                        "2 cups fresh strawberries, hulled",
                        "1 banana, peeled",
                        "1 cup vanilla Greek yogurt",
                        "1/2 cup milk of choice",
                        "2 tbsp honey",
                        "1 cup ice cubes",
                        "Mint leaves for garnish"
                    ],
                    instructions: [
                        "Wash and hull the strawberries, then add to blender.",
                        "Add banana, Greek yogurt, milk, and honey to the blender.",
                        "Add ice cubes for a thicker, colder smoothie.",
                        "Blend on high speed for 60-90 seconds until completely smooth.",
                        "Taste and adjust sweetness with additional honey if needed.",
                        "Pour into glasses and garnish with fresh mint leaves.",
                        "Serve immediately for best taste and texture."
                    ],
                    dateAdded: new Date().toISOString()
                },
                {
                    id: generateId(),
                    name: "Homemade Granola Bars",
                    category: "snack",
                    prepTime: 15,
                    cookTime: 25,
                    servings: 12,
                    image: "https://images.unsplash.com/photo-1606313564200-e75d5e30476c?w=400&h=300&fit=crop",
                    ingredients: [
                        "2 cups old-fashioned oats",
                        "1/2 cup chopped almonds",
                        "1/2 cup dried cranberries",
                        "1/4 cup sunflower seeds",
                        "1/4 cup honey",
                        "1/4 cup almond butter",
                        "2 tbsp coconut oil",
                        "1 tsp vanilla extract",
                        "1/2 tsp cinnamon",
                        "1/4 tsp salt"
                    ],
                    instructions: [
                        "Preheat oven to 350°F (175°C). Line an 8x8 pan with parchment paper.",
                        "Mix oats, almonds, cranberries, and sunflower seeds in a large bowl.",
                        "In a small saucepan, warm honey, almond butter, and coconut oil.",
                        "Stir in vanilla, cinnamon, and salt until well combined.",
                        "Pour the warm mixture over the dry ingredients and mix thoroughly.",
                        "Press mixture firmly into the prepared pan using a spatula.",
                        "Bake for 20-25 minutes until golden brown around edges.",
                        "Cool completely in pan before cutting into bars.",
                        "Store in an airtight container for up to one week."
                    ],
                    dateAdded: new Date().toISOString()
                }
            ];
            
            recipes = sampleRecipes;
            saveRecipes();
            displayFeaturedRecipes();
            displayAllRecipes();
        }

        // Navigation functions
        function showSection(sectionName) {
            console.log('Switching to section:', sectionName); // Debug log
            
            // Hide all sections
            Object.values(sections).forEach(section => {
                if (section) section.classList.remove('active');
            });
            
            // Show selected section
            if (sections[sectionName]) {
                sections[sectionName].classList.add('active');
                console.log('Section activated:', sectionName); // Debug log
            } else {
                console.error('Section not found:', sectionName, sections); // Debug log
            }
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            // Find and activate the correct button
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                const onClick = btn.getAttribute('onclick');
                if (onClick && onClick.includes(`'${sectionName}'`)) {
                    btn.classList.add('active');
                }
            });
            
            // Clear search when navigating via navigation buttons (not from search)
            if (sectionName === 'view-recipes') {
                // Clear search state when manually navigating to My Recipes
                clearSearch();
                displayAllRecipes();
            } else if (sectionName === 'home') {
                displayFeaturedRecipes();
            }
        }

        // Form handling functions
        function addIngredient() {
            const container = document.getElementById('ingredients-container');
            const newInput = document.createElement('div');
            newInput.className = 'ingredient-input';
            newInput.innerHTML = `
                <input type="text" placeholder="Enter ingredient" required>
                <button type="button" onclick="removeIngredient(this)" class="delete-btn">×</button>
            `;
            container.appendChild(newInput);
        }

        function removeIngredient(button) {
            const container = document.getElementById('ingredients-container');
            if (container.children.length > 1) {
                button.parentElement.remove();
            }
        }

        function addInstruction() {
            const container = document.getElementById('instructions-container');
            const newInput = document.createElement('div');
            newInput.className = 'instruction-input';
            newInput.innerHTML = `
                <textarea placeholder="Enter instruction step" required></textarea>
                <button type="button" onclick="removeInstruction(this)" class="delete-btn">×</button>
            `;
            container.appendChild(newInput);
        }

        function removeInstruction(button) {
            const container = document.getElementById('instructions-container');
            if (container.children.length > 1) {
                button.parentElement.remove();
            }
        }

        // Form submission
        function handleFormSubmit(event) {
            event.preventDefault();
            
            // Collect ingredients
            const ingredients = [];
            document.querySelectorAll('#ingredients-container input').forEach(input => {
                if (input.value.trim()) {
                    ingredients.push(input.value.trim());
                }
            });
            
            // Collect instructions
            const instructions = [];
            document.querySelectorAll('#instructions-container textarea').forEach(textarea => {
                if (textarea.value.trim()) {
                    instructions.push(textarea.value.trim());
                }
            });
            
            // Validate required fields
            if (ingredients.length === 0) {
                alert('Please add at least one ingredient.');
                return;
            }
            
            if (instructions.length === 0) {
                alert('Please add at least one instruction step.');
                return;
            }
            
            // Handle image file
            const imageFile = document.getElementById('recipe-image').files[0];
            let imageUrl = '';
            
            // If an image is selected, convert it to base64 for storage
            if (imageFile) {
                // Convert image to base64
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageUrl = e.target.result; // This will be a base64 data URL
                    
                    // Create recipe object with base64 image
                    const recipe = {
                        id: generateId(),
                        name: document.getElementById('recipe-name').value.trim(),
                        category: document.getElementById('recipe-category').value,
                        prepTime: parseInt(document.getElementById('prep-time').value),
                        cookTime: parseInt(document.getElementById('cook-time').value),
                        servings: parseInt(document.getElementById('servings').value),
                        image: imageUrl,
                        ingredients: ingredients,
                        instructions: instructions,
                        dateAdded: new Date().toISOString()
                    };
                    
                    // Add recipe to collection and save
                    recipes.push(recipe);
                    saveRecipes();
                    
                    // Show success message
                    showSuccessMessage();
                    
                    // Reset form
                    document.getElementById('recipe-form').reset();
                    resetDynamicInputs();
                    
                    // Refresh displays
                    displayFeaturedRecipes();
                    displayAllRecipes();
                };
                reader.readAsDataURL(imageFile);
            } else {
                // No image selected, create recipe without image
                const recipe = {
                    id: generateId(),
                    name: document.getElementById('recipe-name').value.trim(),
                    category: document.getElementById('recipe-category').value,
                    prepTime: parseInt(document.getElementById('prep-time').value),
                    cookTime: parseInt(document.getElementById('cook-time').value),
                    servings: parseInt(document.getElementById('servings').value),
                    image: imageUrl,
                    ingredients: ingredients,
                    instructions: instructions,
                    dateAdded: new Date().toISOString()
                };
                
                // Add recipe to collection and save
                recipes.push(recipe);
                saveRecipes();
                
                // Show success message
                showSuccessMessage();
                
                // Reset form
                document.getElementById('recipe-form').reset();
                resetDynamicInputs();
                
                // Refresh displays
                displayFeaturedRecipes();
                displayAllRecipes();
            }
        }

        function resetDynamicInputs() {
            // Reset ingredients to one input
            const ingredientsContainer = document.getElementById('ingredients-container');
            ingredientsContainer.innerHTML = `
                <div class="ingredient-input">
                    <input type="text" placeholder="Enter ingredient" required>
                    <button type="button" onclick="removeIngredient(this)" class="delete-btn">×</button>
                </div>
            `;
            
            // Reset instructions to one input
            const instructionsContainer = document.getElementById('instructions-container');
            instructionsContainer.innerHTML = `
                <div class="instruction-input">
                    <textarea placeholder="Enter instruction step" required></textarea>
                    <button type="button" onclick="removeInstruction(this)" class="delete-btn">×</button>
                </div>
            `;
        }

        // Display functions
        function displayFeaturedRecipes() {
            const container = document.getElementById('featured-recipes');
            if (!container) return;
            
            // Show latest 3 recipes
            const featured = recipes.slice(-3).reverse();
            
            if (featured.length === 0) {
                container.innerHTML = `
                    <div class="no-recipes">
                        <span class="icon">🍴</span>
                        <p>No recipes yet. Add your first recipe to get started!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = featured.map(recipe => createRecipeCard(recipe)).join('');
        }

        function displayAllRecipes() {
            const container = document.getElementById('recipes-container');
            if (!container) return;
            
            // Get category filter element at the beginning
            const categoryFilter = document.getElementById('category-filter');
            let recipesToShow;
            
            // If search is active, show search results
            if (isSearchActive && currentSearchTerm) {
                recipesToShow = recipes.filter(recipe => {
                    return recipe.name.toLowerCase().includes(currentSearchTerm.toLowerCase()) ||
                           recipe.category.toLowerCase().includes(currentSearchTerm.toLowerCase()) ||
                           recipe.ingredients.some(ingredient => ingredient.toLowerCase().includes(currentSearchTerm.toLowerCase()));
                });
            } else {
                // Check if we have an active filter
                const filterValue = categoryFilter ? categoryFilter.value : '';
                
                if (filterValue && filterValue !== '') {
                    // Apply the current filter
                    recipesToShow = recipes.filter(recipe => recipe.category === filterValue);
                } else {
                    // Show all recipes
                    recipesToShow = recipes;
                }
            }
            
            if (recipesToShow.length === 0) {
                if (isSearchActive && currentSearchTerm) {
                    container.innerHTML = `
                        <div class="no-recipes">
                            <span class="icon">🔍</span>
                            <p>No recipes found matching "${currentSearchTerm}". <button onclick="clearSearch()" style="background: none; border: none; color: #667eea; text-decoration: underline; cursor: pointer;">Clear search</button></p>
                        </div>
                    `;
                } else if (categoryFilter && categoryFilter.value && categoryFilter.value !== '') {
                    const categoryName = formatCategory(categoryFilter.value);
                    container.innerHTML = `
                        <div class="no-recipes">
                            <span class="icon">🍽️</span>
                            <p>No ${categoryName} recipes found. <button onclick="clearFilter()" style="background: none; border: none; color: #667eea; text-decoration: underline; cursor: pointer;">Show all recipes</button></p>
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="no-recipes">
                            <span class="icon">🍴</span>
                            <p>No recipes yet. Add your first recipe to get started!</p>
                        </div>
                    `;
                }
                return;
            }
            
            container.innerHTML = recipesToShow.map(recipe => createRecipeCard(recipe)).join('');
        }

        function createRecipeCard(recipe) {
            const totalTime = recipe.prepTime + recipe.cookTime;
            const imageElement = recipe.image && recipe.image.trim() !== '' ? 
                `<img src="${recipe.image}" alt="${recipe.name}" class="recipe-image" onerror="this.outerHTML='<div class=\\'recipe-image-placeholder\\'>🍽️</div>'">` :
                `<div class="recipe-image-placeholder">🍽️</div>`;
            
            return `
                <div class="recipe-card" data-id="${recipe.id}">
                    <div class="recipe-actions">
                        <button class="delete-recipe-btn" onclick="deleteRecipe('${recipe.id}', event)" title="Delete Recipe">×</button>
                    </div>
                    <div onclick="showRecipeDetail('${recipe.id}')">
                        ${imageElement}
                        <div class="recipe-content">
                            <h3 class="recipe-title">${recipe.name}</h3>
                            <div class="recipe-meta">
                                <span>⏰ ${totalTime} min</span>
                                <span>👥 ${recipe.servings} servings</span>
                            </div>
                            <span class="recipe-category">${formatCategory(recipe.category)}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Recipe detail modal
        function showRecipeDetail(recipeId) {
            const recipe = recipes.find(r => r.id === recipeId);
            if (!recipe) return;
            
            const modal = document.getElementById('recipe-modal');
            const detailContainer = document.getElementById('recipe-detail');
            
            const imageElement = recipe.image ? 
                `<img src="${recipe.image}" alt="${recipe.name}" class="recipe-detail-image" onerror="this.style.display='none'">` :
                '';
            
            detailContainer.innerHTML = `
                <div class="recipe-detail-header">
                    ${imageElement}
                    <h2 class="recipe-detail-title">${recipe.name}</h2>
                    <div class="recipe-detail-meta">
                        <div class="meta-item">
                            <span class="icon">⏰</span>
                            <span>Prep: ${recipe.prepTime} min</span>
                        </div>
                        <div class="meta-item">
                            <span class="icon">🔥</span>
                            <span>Cook: ${recipe.cookTime} min</span>
                        </div>
                        <div class="meta-item">
                            <span class="icon">👥</span>
                            <span>Serves: ${recipe.servings}</span>
                        </div>
                        <div class="meta-item">
                            <span class="icon">🏷️</span>
                            <span>${formatCategory(recipe.category)}</span>
                        </div>
                    </div>
                </div>
                
                <div class="ingredients-section">
                    <h3><span class="icon">📝</span> Ingredients</h3>
                    <ul class="ingredients-list">
                        ${recipe.ingredients.map(ingredient => `<li>${ingredient}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="instructions-section">
                    <h3><span class="icon">📋</span> Instructions</h3>
                    <ol class="instructions-list">
                        ${recipe.instructions.map(instruction => `<li>${instruction}</li>`).join('')}
                    </ol>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function closeModal() {
            const modal = document.getElementById('recipe-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // Delete recipe function
        function deleteRecipe(recipeId, event) {
            event.stopPropagation(); // Prevent triggering recipe detail modal
            
            if (confirm('Are you sure you want to delete this recipe?')) {
                // Find and remove recipe from array
                const recipeIndex = recipes.findIndex(r => r.id === recipeId);
                if (recipeIndex !== -1) {
                    recipes.splice(recipeIndex, 1);
                    saveRecipes();
                    
                    // Refresh displays
                    displayFeaturedRecipes();
                    displayAllRecipes();
                    
                    // Show success message
                    showDeleteMessage();
                }
            }
        }

        function showDeleteMessage() {
            const message = document.getElementById('success-message');
            if (message) {
                const icon = message.querySelector('.icon');
                const text = message.querySelector('span:last-child');
                
                // Change to delete message
                icon.textContent = '🗑️';
                text.textContent = 'Recipe deleted successfully!';
                message.style.background = '#ff4757';
                
                message.classList.add('show');
                setTimeout(() => {
                    message.classList.remove('show');
                    // Reset back to save message
                    setTimeout(() => {
                        message.style.background = '#2ed573';
                    }, 300);
                }, 3000);
            }
        }

        // Search functionality - FIXED
        function searchRecipes() {
            const searchInput = document.getElementById('search-input');
            if (!searchInput) return;
            
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            if (!searchTerm) {
                // Clear search
                clearSearch();
                return;
            }
            
            // Set search state
            currentSearchTerm = searchTerm;
            isSearchActive = true;
            
            // Clear any active filters
            const categoryFilter = document.getElementById('category-filter');
            if (categoryFilter) {
                categoryFilter.value = '';
            }
            
            // Navigate to My Recipes without clearing search
            navigateToViewRecipes();
            displayAllRecipes();
        }

        // Navigate to view recipes without clearing search (used by search)
        function navigateToViewRecipes() {
            // Hide all sections
            Object.values(sections).forEach(section => {
                if (section) section.classList.remove('active');
            });
            
            // Show view-recipes section
            if (sections['view-recipes']) {
                sections['view-recipes'].classList.add('active');
            }
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            // Find and activate My Recipes button
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                const onClick = btn.getAttribute('onclick');
                if (onClick && onClick.includes("'view-recipes'")) {
                    btn.classList.add('active');
                }
            });
        }

        // Clear search function
        function clearSearch() {
            currentSearchTerm = '';
            isSearchActive = false;
            
            // Clear search input
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.value = '';
            }
            
            // Reset filter dropdown
            const categoryFilter = document.getElementById('category-filter');
            if (categoryFilter) {
                categoryFilter.value = '';
            }
            
            // Show all recipes
            if (sections['view-recipes'] && sections['view-recipes'].classList.contains('active')) {
                displayAllRecipes();
            }
        }

        // Clear filter function
        function clearFilter() {
            // Clear any active search
            currentSearchTerm = '';
            isSearchActive = false;
            
            // Clear search input
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.value = '';
            }
            
            // Reset filter dropdown
            const categoryFilter = document.getElementById('category-filter');
            if (categoryFilter) {
                categoryFilter.value = '';
            }
            
            // Show all recipes
            displayAllRecipes();
        }

        // Filter functionality - FIXED
        function filterRecipes() {
            console.log('filterRecipes called');
            
            // Clear any active search when filtering
            isSearchActive = false;
            currentSearchTerm = '';
            
            // Clear search input
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.value = '';
            }
            
            // Get current filter value
            const categoryFilter = document.getElementById('category-filter');
            const filterValue = categoryFilter ? categoryFilter.value : '';
            console.log('Current filter value:', filterValue);
            
            // Force refresh the display immediately
            displayAllRecipes();
        }

        // Storage functions
        function saveRecipes() {
            try {
                localStorage.setItem('recipeBook', JSON.stringify(recipes));
            } catch (e) {
                console.warn('Could not save to localStorage:', e);
            }
        }

        function loadRecipes() {
            try {
                const saved = localStorage.getItem('recipeBook');
                if (saved) {
                    recipes = JSON.parse(saved);
                }
            } catch (e) {
                console.warn('Could not load from localStorage:', e);
                recipes = [];
            }
        }

        // Utility functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatCategory(category) {
            return category.split('-').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        function showSuccessMessage() {
            const message = document.getElementById('success-message');
            if (message) {
                message.classList.add('show');
                setTimeout(() => {
                    message.classList.remove('show');
                }, 3000);
            }
        }

        // Event listeners for keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });

        // Make functions globally available
        window.showSection = showSection;
        window.addIngredient = addIngredient;
        window.removeIngredient = removeIngredient;
        window.addInstruction = addInstruction;
        window.removeInstruction = removeInstruction;
        window.searchRecipes = searchRecipes;
        window.filterRecipes = filterRecipes;
        window.showRecipeDetail = showRecipeDetail;
        window.closeModal = closeModal;
        window.deleteRecipe = deleteRecipe;
        window.clearSearch = clearSearch;
        window.clearFilter = clearFilter;
    </script>
</body>
</html>
